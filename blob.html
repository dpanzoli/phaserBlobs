
<html>
<meta charset="utf-8">
<script src="phaser.min.js"></script>
<script>

var config = {
    type: Phaser.WEBGL,
    width: 800,
    height: 800,
    backgroundColor: '#000',
    parent: 'phaser-example',
    scene: {
        preload: preload,
        create: create,
		update: update
    },
	physics: {
        default: 'arcade',
        arcade: {
            debug: false
        }
    },
};

var game = new Phaser.Game(config);

function preload ()
{
    this.load.atlas('flares', 'flares.png', 'flares.json');
	this.load.image('face','face.png');
	
	this.load.image('arrow','arrow.png');
}

function create ()
{
    var particles = this.add.particles('flares');
	var blobGroup = this.physics.add.group({
		bounceX: 1,
		bounceY: 1,
		collideWorldBounds: true
	});

	var container = this.add.container(200,150);
	var controle = this.add.container(0,0);
	container.add(controle);
	var grosBlob = this.physics.add.image(0, 0, 'face');
	grosBlob.setInteractive();
	grosBlob.setCircle(40,-24,-24);
	grosBlob.setScale(1.5);
	grosBlob.emitter = particles.createEmitter({
		frame:  ['blue'],
		quantity: 10,
        lifespan: 1000,
        blendMode: 'ADD',
		emitZone: {source: new Phaser.Geom.Circle(0, 0, 25)},
		follow : container,
		scale: { start: 1, end: 0, ease: 'linear' }
    });
	blobGroup.add(grosBlob);
	container.add(grosBlob);
	var dir = this.add.image(100,0,'arrow');
	controle.add(dir);
	controle.setRotation(0);
	
	var moyenBlob = this.physics.add.image(200,300, 'face');
	moyenBlob.setInteractive();
	moyenBlob.setCircle(32,-16,-16);
	blobGroup.add(moyenBlob);
	moyenBlob.emitter = particles.createEmitter({
 		frame:  ['green'] ,
		quantity: 10,
		scale: { start: 0.5, end: 0, ease: 'linear' },
        lifespan: 500,
        blendMode: 'ADD',
		emitZone: {source: new Phaser.Geom.Circle(0, 0, 25)},
		follow : moyenBlob,
		//followOffset: {x:100, y:100},
    });

	console.log(container);
	
	var petitBlob = this.physics.add.image(200,450, 'face');
	petitBlob.setInteractive();
	petitBlob.setCircle(32,-16,-16);
	petitBlob.setScale(0.66);
	blobGroup.add(petitBlob);
	petitBlob.emitter = particles.createEmitter({
 		frame:  ['yellow'] ,
		quantity: 20,
		scale: { start: 0.3, end: 0, ease: 'linear' },
        lifespan: 300,
        blendMode: 'ADD',
		emitZone: {source: new Phaser.Geom.Circle(0, 0, 20)},
		follow : petitBlob,
		//followOffset: {x:-100, y:0},
    });	

	//Les blobs subissent la physique
	this.physics.add.collider(blobGroup, blobGroup);
	
	this.input.on('pointermove', function (pointer) {
		
		var angle = Phaser.Math.Angle.Between(
			container.x,
			container.y,
			pointer.worldX,
			pointer.worldY
		);
		controle.setRotation(angle);
		
		var distance = Phaser.Math.Distance.Between(
			container.x,
			container.y,
			pointer.worldX,
			pointer.worldY
		);
		if (distance<80) {
			dir.visible = false;
		} else {
			dir.visible = true;
			var norm = (Math.min(distance,300) - 80)/300.0
			//modifier la taille de la flèche
			dir.setScale(norm + 0.5);
			//modifier la distance de la flèche
			dir.x = 80 + (norm*50);
		}
		
	});
}

function update() {}


</script>

</html>